services:
  ccfwp:
    # Build from the PARENT directory (project root) using the Dockerfile in deploy/ folder
    build:
      context: ../
      dockerfile: deploy/Dockerfile
    image: ccfwp:latest
    container_name: ccfwp-container
    ports:
      - "8001:8001"
      - "9100:9100"
      # Reserve ports for user projects
      - "8002-8020:8002-8020"
    volumes:
      # Persistent Data Volume
      # Maps local .platform-data folder to the container
      - ../.platform-data:/app/.platform-data
    environment:
      - NODE_ENV=production
      - PORT=8001
      - R2_ADMIN_PORT=9100
      - PORT_RANGE_START=8002
      - PORT_RANGE_END=8020
    restart: unless-stopped
